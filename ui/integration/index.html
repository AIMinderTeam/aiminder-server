<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 목표 코칭봇 - 통합 플랫폼</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 로딩 스피너 -->
    <div id="loadingSpinner" class="loading-overlay">
        <div class="spinner">
            <div class="spinner-ring"></div>
        </div>
        <p>로딩 중...</p>
    </div>

    <!-- 로그인 화면 -->
    <div id="loginScreen" class="screen hidden">
        <div class="login-container">
            <div class="login-box">
                <div class="logo-section">
                    <h1>🎯 AI 목표 코칭봇</h1>
                    <p class="subtitle">SMART 목표 달성을 위한 개인화된 AI 코치</p>
                </div>

                <div class="login-content">
                    <h2>로그인</h2>
                    <p>개인화된 목표 달성 서비스를 이용하려면 로그인이 필요합니다.</p>

                    <div class="oauth-buttons">
                        <button id="loginGoogle" class="btn btn-google">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Google로 로그인
                        </button>

                        <button id="loginKakao" class="btn btn-kakao">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12 3C6.477 3 2 6.477 2 10.8c0 2.72 1.82 5.1 4.5 6.48-.18-.66-.34-1.68.08-2.42.38-.66 2.47-2.64 2.47-2.64s-.63-.126-.63-1.566c0-1.468.85-2.562 1.908-2.562.9 0 1.335.675 1.335 1.485 0 .9-.574 2.25-.87 3.498-.248 1.05.527 1.908 1.566 1.908 1.88 0 3.33-1.98 3.33-4.84 0-2.53-1.82-4.3-4.42-4.3-3.012 0-4.78 2.256-4.78 4.59 0 .91.35 1.88.79 2.41.09.1.1.19.07.3-.08.32-.25 1.02-.29 1.16-.05.19-.17.23-.39.14-1.36-.63-2.21-2.61-2.21-4.21 0-3.33 2.42-6.39 6.98-6.39 3.67 0 6.53 2.61 6.53 6.1 0 3.64-2.29 6.57-5.47 6.57-1.07 0-2.07-.56-2.42-1.23 0 0-.53 2.01-.66 2.51-.24.94-.89 2.12-1.32 2.84C10.18 20.64 11.08 21 12 21c5.523 0 10-3.477 10-7.8C22 6.477 17.523 3 12 3z"/>
                            </svg>
                            카카오로 로그인
                        </button>
                    </div>

                    <div class="login-actions">
                        <button id="checkSessionBtn" class="btn btn-secondary">세션 확인</button>
                    </div>

                    <div id="loginStatus" class="status-container hidden">
                        <div id="statusContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메인 챗봇 화면 -->
    <div id="chatScreen" class="screen hidden">
        <div class="chat-container">
            <!-- 대화 기록 패널 -->
            <div class="history-panel" id="historyPanel">
                <div class="history-header">
                    <h2>💬 대화 기록</h2>
                    <button class="close-history" id="closeHistory">×</button>
                </div>
                <div class="conversation-list" id="conversationList">
                    <!-- 대화 기록 목록이 여기에 동적으로 추가됩니다 -->
                </div>
                <button class="new-chat-btn" id="newChatBtn">+ 새 대화 시작하기</button>
            </div>

            <!-- 메인 헤더 -->
            <div class="chat-header">
                <button class="header-btn history-btn" id="historyBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" fill="currentColor"/>
                    </svg>
                </button>
                
                <div class="header-content">
                    <h1>🎯 AI 목표 코칭봇</h1>
                    <div class="subtitle">SMART 목표 달성을 도와드립니다</div>
                </div>

                <div class="header-actions">
                    <button class="header-btn theme-toggle" id="themeToggle">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 20V4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z" fill="currentColor"/>
                        </svg>
                    </button>
                    
                    <div class="user-menu" id="userMenu">
                        <button class="header-btn user-btn" id="userBtn">
                            <div class="user-avatar" id="userAvatar">👤</div>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-info" id="userInfo">
                                <div class="user-name" id="userName">사용자</div>
                                <div class="user-email" id="userEmail">user@example.com</div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" id="logoutBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                로그아웃
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 채팅 메시지 영역 -->
            <div class="chat-messages" id="chatMessages">
                <div id="messageContainer"></div>
                <div class="typing-indicator" id="typingIndicator">
                    <span>AI가 응답 중입니다</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- 입력 영역 -->
            <div class="chat-input-container">
                <form class="chat-input-form" id="chatForm">
                    <textarea
                        class="chat-input"
                        id="chatInput"
                        placeholder="메시지를 입력하세요..."
                        maxlength="1000"
                        rows="1"
                    ></textarea>
                    <button type="submit" class="send-btn" id="sendBtn">
                        <svg viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="currentColor"/>
                        </svg>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- 에러 모달 -->
    <div id="errorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚠️ 오류 발생</h3>
                <button class="modal-close" id="errorModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="errorMessage">알 수 없는 오류가 발생했습니다.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="errorModalOk">확인</button>
            </div>
        </div>
    </div>

    <!-- JavaScript 모듈 로드 -->
    <script src="utils.js"></script>
    <script src="auth.js"></script>
    <script src="chatbot.js"></script>
    <script src="app.js"></script>
</body>
</html>